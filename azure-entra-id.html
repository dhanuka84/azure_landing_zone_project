<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azure Entra ID Model (Zero Trust)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f4f8; font-family: 'Inter', sans-serif; color: #334155; }
        .container-box { background-color: white; border-radius: 0.75rem; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); padding: 1.5rem; margin-bottom: 1.5rem; }
        .title { font-size: 1.125rem; font-weight: 600; color: #1e293b; margin-bottom: 0.25rem; }
        .purpose { font-size: 0.875rem; color: #64748b; margin-bottom: 1rem; font-style: italic; }
        .item-list { list-style: none; padding-left: 1.25rem; border-left: 2px solid #cbd5e1; }
        .item-list li { position: relative; padding-left: 1rem; margin-bottom: 0.75rem; }
        .item-list li::before { content: ''; position: absolute; left: -1.25rem; top: 0.5em; width: 0.75rem; height: 2px; background-color: #cbd5e1; }
        .item-title { font-weight: 500; color: #475569; }
        .item-detail { font-size: 0.875rem; color: #64748b; display: block; }
        .icon { margin-right: 0.5rem; color: #3b82f6; }
        .rbac-tag { background-color: #fefce8; color: #a16207; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 500; display: inline-block; margin-top: 0.5rem; }
        .identity-type-tag { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-left: 0.5rem; }
        .oidc-tag { background-color: #e0f2fe; color: #0369a1; } /* Light blue */
        .uami-tag { background-color: #dcfce7; color: #166534; } /* Light green */
    </style>
     <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="p-8">

    <h1 class="text-3xl font-bold text-center mb-4 text-slate-800">Azure Entra ID - Modern Identity Model (Zero Trust)</h1>
    <p class="text-center text-slate-500 mb-12 max-w-3xl mx-auto">Illustrating the use of User-Assigned Managed Identities (UAMI) and Workload Identity Federation (OIDC) for credential-less access, aligned with Zero Trust principles.</p>

    <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="container-box md:col-span-2">
            <h2 class="title"><i class="fas fa-users-cog icon"></i>Microsoft Entra ID Tenant</h2>
            <p class="purpose">Central identity provider managing users, groups, and modern workload identities.</p>
            <ul class="item-list mt-4">
                <li><span class="item-title"><i class="fas fa-user icon"></i>Users and Groups</span> <span class="item-detail">Standard users and administrative groups (e.g., "AKS Admins"). Access governed by PIM.</span></li>
                <li>
                    <span class="item-title"><i class="fas fa-robot icon"></i>Workload Identities (Credential-less)</span>
                    <span class="item-detail">Managed identities for Azure resources and federated identities for external systems.</span>
                    <ul class="item-list mt-2">
                        <li class="pt-2 border-t border-slate-200 mt-2"><span class="item-title text-orange-600">-- CI/CD Pipeline Identity --</span><span class="identity-type-tag oidc-tag">OIDC / WIF</span></li>
                        <li><span class="item-title">azdo-oidc-platform:</span> <span class="item-detail">Federated identity for Azure DevOps pipeline deploying Platform resources. Trusts AzDO OIDC tokens.</span></li>
                        <li><span class="item-title">azdo-oidc-nonprod:</span> <span class="item-detail">Federated identity for deploying Non-Prod resources (Dev, QA).</span></li>
                        <li><span class="item-title">azdo-oidc-prod:</span> <span class="item-detail">Federated identity for deploying Prod resources.</span></li>

                        <li class="pt-2 border-t border-slate-200 mt-2"><span class="item-title text-emerald-600">-- Application Workload Identities --</span><span class="identity-type-tag uami-tag">UAMI</span></li>
                        <li><span class="item-title">uami-prod-api-workload:</span> <span class="item-detail">Managed Identity assigned to Prod AKS pods needing Key Vault access.</span></li>
                        <li><span class="item-title">uami-qa-api-workload:</span> <span class="item-detail">Managed Identity for QA workloads.</span></li>
                        <li><span class="item-title">uami-dev-api-workload:</span> <span class="item-detail">Managed Identity for Dev workloads.</span></li>
                        <li><span class="item-title">uami-prod-appgw:</span> <span class="item-detail">Managed Identity assigned to Prod App Gateway for accessing Key Vault SSL Certs.</span></li>
                    </ul>
                </li>
            </ul>
        </div>

         <div class="container-box">
            <h2 class="title"><i class="fas fa-user-lock icon"></i>RBAC Assignment Strategy</h2>
            <p class="purpose">Applying least privilege using modern identities.</p>
            <ul class="item-list mt-4">
                 <li>
                    <span class="item-title">CI/CD Pipeline (OIDC)</span><span class="identity-type-tag oidc-tag">OIDC / WIF</span>
                    <span class="item-detail">Roles assigned directly to the Service Principal associated with the OIDC Federated Credential (managed in Azure Portal/CLI, not Terraform state).</span>
                    <ul class="item-list mt-2">
                        <li><span class="item-detail">`azdo-oidc-prod` needs: Contributor/AKS Cluster Admin on Prod Sub, AcrPush on Prod ACR.</span></li>
                        <li><span class="item-detail">`azdo-oidc-nonprod` needs: Contributor on Dev/QA Subs.</span></li>
                         <li><span class="item-detail">`azdo-oidc-platform` needs: Contributor on Connectivity Sub, MG Contributor on Platform MG.</span></li>
                    </ul>
                 </li>
                 <li>
                     <span class="item-title">Application Workloads (UAMI)</span><span class="identity-type-tag uami-tag">UAMI</span>
                    <span class="item-detail">Roles assigned via Terraform `rbac` module, referencing the UAMI `principal_id`.</span>
                     <ul class="item-list mt-2">
                        <li><span class="item-detail">`uami-prod-api-workload` assigned "Key Vault Secrets User" on `kv-prod-secrets`.</span></li>
                        <li><span class="item-detail">`uami-qa-api-workload` assigned "Key Vault Secrets User" on QA Key Vault.</span></li>
                    </ul>
                 </li>
                  <li>
                     <span class="item-title">Infrastructure Services (UAMI)</span><span class="identity-type-tag uami-tag">UAMI</span>
                    <span class="item-detail">Roles assigned via Terraform or Portal/CLI.</span>
                     <ul class="item-list mt-2">
                        <li><span class="item-detail">`uami-prod-appgw` assigned "Key Vault Secrets User" on `kv-prod-secrets`.</span></li>
                    </ul>
                 </li>
                 <li>
                    <span class="item-title">Human Administrators</span>
                    <span class="item-detail">Roles assigned to Entra ID Groups, eligible via PIM.</span>
                 </li>
            </ul>
            <div class="rbac-tag mt-4">Terraform `rbac` module assigns roles primarily to UAMIs. OIDC SP roles managed outside TF state.</div>
        </div>

        <div class="container-box">
            <h2 class="title"><i class="fas fa-info-circle icon"></i>Key Principles & Notes</h2>
            <ul class="list-disc pl-5 mt-4 space-y-2 text-sm text-slate-600">
                <li><span class="font-semibold">Eliminate Static Secrets:</span> OIDC for pipelines and UAMI for Azure workloads remove the need for managing client secrets or certificates.</li>
                <li><span class="font-semibold">Least Privilege:</span> Identities are granted only the necessary roles on specific scopes (resource, resource group, subscription).</li>
                <li><span class="font-semibold">Declarative RBAC (for UAMI):</span> UAMI creation and role assignments are managed within Terraform state, ensuring infrastructure and identity permissions evolve together.</li>
                 <li><span class="font-semibold">External RBAC (for OIDC):</span> Role assignments for OIDC service principals are configured once in Entra ID, decoupling pipeline permissions from the Terraform codebase.</li>
                <li><span class="font-semibold">PIM for Admins:</span> Human administrative access uses Just-in-Time elevation via Entra ID PIM.</li>
            </ul>
        </div>
    </div>
</body>
</html>